和卡尔曼滤波差不多，互补滤波的核心思想在于​​融合多个传感器的数据，发挥各自优势，弥补各自劣势。他的目标也就是融合两种（或多种）具有​**​互补噪声特性​**​的传感器数据，以获得对同一物理量（通常是角度或位置）​更优的估计

按照惯例，我们先用人话概括一下：​假设我有两路信号，一个带有高频噪声，一个带有低频噪声，所以我把他们的噪声分别滤除，然后合并，就得到了没有噪声的原始信号。

因为互补滤波这个东西一般用来做姿态解算，因此我们就用姿态解算作为例子来深入了解一下他的原理。请注意，我们所熟知的Mahony算法其实也是互补滤波，不过他是优化过的非线性互补滤波，不要混淆了。

# 一些基本概念

- **高通滤波**：高通滤波器允许信号中​**​高于​**​某个特定频率（​**​截止频率​**​）的成分​**​相对容易地通过​**​，而对​**​低于​**​截止频率的成分进行​**​衰减（减弱）**。这样可以**​**​突出信号中快速变化的部分。
- **低通滤波**：低通滤波就反过来，让低频的过，滤去高频信号。这样的信号更平滑。

# Previously

**陀螺仪**用来测量角速度。积分可得角度变化。优点是​**​动态响应好​**​（高频信息准确），缺点是因为积分，测量中的微小​**​零偏误差​**​会随时间​**​累积​**​（积分漂移），导致​**​低频信息不可靠​**​（长期估计发散）。

**加速度计**测量三轴加速度（包括重力加速度）。在​**​物体相对静止或慢速运动​**​时，可以通过重力矢量分量计算出​**​绝对倾角​**​。优点是​**​低频信息准确​**​（长期估计稳定，无累积误差），缺点是对​**​高频振动/运动​**​非常敏感（高频噪声大），导致​**​高频信息不可靠​**​（瞬时估计噪声大、可能错误）。

综上，我们其实可以看出这两种数据其实是存在互补性的，也就是我们可以拿陀螺仪的高频部分和加速度计的低频部分来实现互补，融合出一个更好的姿态估计数据。但是，真是这样吗？

# 符号

- $w$：表示角速度

# 线性互补滤波

很显然，我们首先可以知道这样的关系式：
$$angle = angle_{0} + w t$$
这样我们就能根据这个角速度算出当前的角度。但是初始状态呢？

我们假设刚开始的时候，物体处于静止的状态，因此在世界坐标系下，我们只有z轴有加速度且为g，其他轴加速度为0。因此我们可以得出：

$$
\begin{aligned}
\begin{bmatrix}
a_x \\
a_y \\
a_z
\end{bmatrix} &= C_n^b \begin{bmatrix}
0 \\
0 \\
g
\end{bmatrix} \\
&= \begin{bmatrix}
\cos \psi \cos \theta & \sin \psi \cos \theta & -\sin \theta \\
\cos \psi \sin \theta \sin \gamma - \sin \psi \cos \gamma & \sin \psi \sin \theta \sin \gamma + \cos \psi \cos \gamma & \cos \theta \sin \gamma \\
\cos \psi \sin \theta \cos \gamma + \sin \psi \sin \gamma & \sin \psi \sin \theta \cos \gamma - \cos \psi \sin \gamma & \cos \theta \cos \gamma
\end{bmatrix} \begin{bmatrix}
0 \\
0 \\
g
\end{bmatrix} \\
&= \begin{bmatrix}
-\sin \theta g \\
\cos \theta \sin \gamma g \\
\cos \theta \cos \gamma g
\end{bmatrix}
\end{aligned}
$$

所以：

$$
\begin{aligned}
angle_{pitch} &= \arcsin(\frac{-a_{x}}{g})\\
angle_{roll} &= \arctan(\frac{a_{y}}{a_{z}})
\end{aligned}
$$

至于yaw角，如果没有磁力计，我们就只能积分z轴角速度。这没办法。

到此，我发现这没有互补，哪来的互补，不就一路输出吗？其实我们这里需要首先给出一些假设：
- 物体运动的时候基本可以认为是受力平衡的，
