前面的[数据链路层]([Welcome To my Blog](https://blog.zerohzzzz.cn/))中我们可以知道，数据链路层是“尽最大努力交付”的，那么我们应该如何实现可靠传输呢？这个时候就需要网络层发挥作用了

首先我们要知道，网络层有什么用？

# 网络层的作用

## 路由选择

网络层最重要的任务是确定数据包的最佳路径并进行转发。这也就是**路由**，路由的核心目标是确保数据包能够跨越多层网络，直到到达目标设备。

路由器是实现路由的关键设备，它根据数据包的目标地址以及网络的拓扑结构来决定数据包的转发路径。

每个路由器都维护一张**路由表**，表中包含了从当前路由器到目标网络的路径信息。比如：

```bash
└─$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.31.1    0.0.0.0         UG    30     0        0 eth5
192.168.31.0    0.0.0.0         255.255.255.0   U     286    0        0 eth5
192.168.31.1    0.0.0.0         255.255.255.255 UH    30     0        0 eth5
```

根据路由选择方法和网络拓扑的类型的不同，常常有以下路由的分类

### 路由种类

#### 静态路由

字面意思，手动配置，不会变化。静态。

#### 动态路由

动态路由使用路由协议自动调整路由路径，根据网络状态变化（如链路失败、网络拓扑变化等）自动更新路由表。

#### 默认路由

默认路由是一种特殊类型的路由，用于当目标地址不在当前路由表中时，将数据包发送到一个预定的“默认”路由器。

#### 直连路由

直连路由是指那些直接连接到路由器的网络。直连路由的目标地址为路由器接口所属网络的地址和子网掩码，下一跳是路由器接口的本地地址。直连路由通常不需要经过其他路由设备进行转发，因为它们是直接可达的。

每个路由器接口上的网络通常都有一条直连路由。

那问题来了，路由表是根据什么什么规则更新的呢？

### 路由协议

路由的实现依赖于路由协议。

#### RIP 距离向量协议

RIP基于跳数来选择路径，最多支持15跳，超过15跳的网络被认为是不可达的。

#### OSPF 链路状态协议

通过交换链路状态信息，构建一个完整的网络拓扑图，然后使用**Dijkstra算法**计算最短路径。

#### BGP 路径向量协议

主要用于自治系统之间的路由选择。

BGP通过交换路径信息来选择最优路由，支持复杂的路由策略（如AS路径、策略路由等）。支持跨自治系统（AS）进行路由

#### EIGRP 混合型协议

结合了距离向量和链路状态的特性，使用DUAL算法来选择最佳路径

### 网关

网关的作用是连接两个或多个不同协议或不同网络架构的网络，使得它们能够进行**互联**，并可以进行协议转换。

## 逻辑地址

这就不得不提著名的互联网协议——IP

IP是网络层协议，它定义了数据包的格式、如何进行寻址、路由和传输。通过IP协议，数据可以从一个设备传输到另一个设备，即使它们位于不同的物理网络中。IP协议不关心数据内容的具体传输，只关心如何把数据从源地址送到目标地址。

主要有两个版本：IPv4、IPv6


### IP地址的结构

#### IPv4地址

由4个字节（32位）组成，通常用十进制表示，并以点分十进制格式（`A.B.C.D`）展示。每个字节（8位）表示一个0到255之间的数值。

#### IPv6地址

由8组16位的十六进制数字组成，每组用冒号（`:`）分隔。IPv6地址比IPv4地址长得多，使用128位地址空间

**简化表示法**：IPv6地址中如果存在连续的零，可以使用`::`来表示一次。例如：`2001:0db8::1`

#### 私有IP与公共IP

-   **私有IP地址**：用于局域网（LAN）内部设备的标识，不会在互联网上路由。私有IP地址有三个范围：
    -   `10.0.0.0 - 10.255.255.255`
    -   `172.16.0.0 - 172.31.255.255`
    -   `192.168.0.0 - 192.168.255.255`
-   **公共IP地址**：用于互联网上唯一标识设备的IP地址。公共IP地址需要通过ISP（互联网服务提供商）分配。
