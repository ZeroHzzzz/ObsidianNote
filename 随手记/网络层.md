前面的[数据链路层]([Welcome To my Blog](https://blog.zerohzzzz.cn/))中我们可以知道，数据链路层是“尽最大努力交付”的，那么我们应该如何实现可靠传输呢？这个时候就需要网络层发挥作用了

首先我们要知道，网络层有什么用？

# 网络层的作用

## 路由选择

网络层最重要的任务是确定数据包的最佳路径并进行转发。这也就是**路由**，路由的核心目标是确保数据包能够跨越多层网络，直到到达目标设备。

路由器是实现路由的关键设备，它根据数据包的目标地址以及网络的拓扑结构来决定数据包的转发路径。

每个路由器都维护一张**路由表**，表中包含了从当前路由器到目标网络的路径信息。比如：

```bash
└─$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.31.1    0.0.0.0         UG    30     0        0 eth5
192.168.31.0    0.0.0.0         255.255.255.0   U     286    0        0 eth5
192.168.31.1    0.0.0.0         255.255.255.255 UH    30     0        0 eth5
```

根据路由选择方法和网络拓扑的类型的不同，常常有以下路由的分类

### 路由种类

#### 静态路由

字面意思，手动配置，不会变化。静态。

#### 动态路由

动态路由使用路由协议自动调整路由路径，根据网络状态变化（如链路失败、网络拓扑变化等）自动更新路由表。

#### 默认路由

默认路由是一种特殊类型的路由，用于当目标地址不在当前路由表中时，将数据包发送到一个预定的“默认”路由器。

#### 直连路由

直连路由是指那些直接连接到路由器的网络。直连路由的目标地址为路由器接口所属网络的地址和子网掩码，下一跳是路由器接口的本地地址。直连路由通常不需要经过其他路由设备进行转发，因为它们是直接可达的。

每个路由器接口上的网络通常都有一条直连路由。

那问题来了，路由表是根据什么什么规则更新的呢？

### 路由协议

路由的实现依赖于路由协议。

#### RIP 距离向量协议

RIP基于跳数来选择路径，最多支持15跳，超过15跳的网络被认为是不可达的。

#### OSPF 链路状态协议

通过交换链路状态信息，构建一个完整的网络拓扑图，然后使用**Dijkstra算法**计算最短路径。

#### BGP 路径向量协议

主要用于自治系统之间的路由选择。

BGP通过交换路径信息来选择最优路由，支持复杂的路由策略（如AS路径、策略路由等）。支持跨自治系统（AS）进行路由

#### EIGRP 混合型协议

结合了距离向量和链路状态的特性，使用DUAL算法来选择最佳路径

### 网关

网关的作用是连接两个或多个不同协议或不同网络架构的网络，使得它们能够进行**互联**，并可以进行协议转换。

## 逻辑地址

这就不得不提著名的互联网协议——IP

IP是网络层协议，它定义了数据包的格式、如何进行寻址、路由和传输。通过IP协议，数据可以从一个设备传输到另一个设备，即使它们位于不同的物理网络中。IP协议不关心数据内容的具体传输，只关心如何把数据从源地址送到目标地址。

主要有两个版本：IPv4、IPv6

### IP地址的组成

#### IPv4

由4个字节（32位）组成，通常用十进制表示，并以点分十进制格式（`A.B.C.D`）展示。每个字节（8位）表示一个0到255之间的数值。

IPv4地址通常分为**网络部分**和**主机部分**

-   **网络部分**：标识一个特定的网络，所有处于同一网络的设备具有相同的网络部分。
-   **主机部分**：标识网络中具体的设备（主机）。

如何区分网络部分和主机部分由**子网掩码**（Subnet Mask）决定。子网掩码是一个32位的二进制数，用来标识IP地址中哪些位是网络部分，哪些是主机部分。
例如：

-   **IP地址**：`192.168.1.10`
-   **子网掩码**：`255.255.255.0`
    -   **网络地址**：`192.168.1.0`，表示整个`192.168.1.x`网段。
    -   **主机地址**：`10`，表示该网段中具体的设备。

#### IPv6

由8组16位的十六进制数字组成，每组用冒号（`:`）分隔。IPv6地址比IPv4地址长得多，使用128位地址空间

**简化表示法**：IPv6地址中如果存在连续的零，可以使用`::`来表示一次。例如：`2001:0db8::1`

1. **前缀（Prefix）**：标识网络部分，通常是一个全球唯一的地址范围，如`2001:0db8::/32`。
2. **接口标识符（Interface Identifier）**：标识设备的部分，通常由设备的MAC地址派生，确保设备的唯一性。

例如：`2001:0db8:85a3:0000:0000:8a2e:0370:7334`中，前64位是前缀，后64位是接口标识符。

### IP地址的分类

#### A类地址

-   **范围**：`1.0.0.0` ~ `126.255.255.255`
-   **特点**：
    -   网络部分占**8位**，主机部分占**24位**。
    -   适用于大型网络，支持大量主机。
-   **默认子网掩码**：`255.0.0.0`（/8）
-   **第一个字节**的范围：`1` ~ `126`
-   **特殊地址**：
    -   `127.x.x.x`：保留用于**回环地址**（如 `127.0.0.1`）。

#### B类地址

-   **范围**：`128.0.0.0` ~ `191.255.255.255`
-   **特点**：
    -   网络部分占**16位**，主机部分占**16位**。
    -   适用于中型网络。
-   **默认子网掩码**：`255.255.0.0`（/16）
-   **第一个字节**的范围：`128` ~ `191`

#### C类地址

-   **范围**：`192.0.0.0` ~ `223.255.255.255`
-   **特点**：
    -   网络部分占**24位**，主机部分占**8位**。
    -   适用于小型网络。
-   **默认子网掩码**：`255.255.255.0`（/24）
-   **第一个字节**的范围：`192` ~ `223`

#### D类地址

-   **范围**：`224.0.0.0` ~ `239.255.255.255`
-   **特点**：
    -   用于**组播通信**（Multicast）。
    -   没有网络和主机部分的划分。
-   **应用**：多点传送（如视频会议、IPTV等）。

#### E类地址(保留地址)

-   **范围**：`240.0.0.0` ~ `255.255.255.255`

#### 私有IP地址与公共IP地址

-   **私有IP地址**：用于局域网（LAN）内部通信，不会在互联网中路由。
    -   **A类**：`10.0.0.0` ~ `10.255.255.255`
    -   **B类**：`172.16.0.0` ~ `172.31.255.255`
    -   **C类**：`192.168.0.0` ~ `192.168.255.255`
-   **公共IP地址**：用于互联网通信，由全球IP地址管理组织分配，确保全球唯一性。
