# 什么是滤波

滤波是信号里面的一个概念，简单说就是从信号里挑出我们想要的部分，同时尽量去掉那些不需要的部分或噪声。

卡尔曼滤波它的核心思想其实是把多个含有误差的数据​**​融合​**​在一起。通过这种融合计算，我们能在很大程度上降低误差的影响，最终得到对真实情况更准、更可靠的一个估计结果。这个过程本质上也是提取更干净、更有用的信息，对两个存在误差的数据中有用的部分进行了增强，就像是过滤掉测量中的噪声，所以这玩意也叫做滤波。

# 一些基本概念

- **状态转移模型 (`F`)：​**​ 描述系统状态如何从时刻`k-1`演变到时刻`k`的数学方程。通常是一个矩阵（状态转移矩阵）。
- **观测模型 (`H`)：​**​ 描述系统的状态(`x`)如何映射为我们能观测到的测量值(`z`)的数学方程（观测矩阵）。它的作用是把预测的状态空间转换到观测空间，以便与实际测量值进行比较和融合。
- **过程噪声 (`w`, 协方差 `Q`)：​**​ 代表驱动系统动态的模型本身的不准确性和外部扰动。例如风对飞行器的影响、路面摩擦力变化对汽车模型的影响。
- **测量噪声 (`v`, 协方差 `R`)：​**​ 代表传感器测量的不精确性和噪声。例如GPS的位置误差、陀螺仪的漂移。
- **状态估计协方差 (`P`)：​**​ 这是卡尔曼滤波的核心“元信息”。它不是一个状态变量本身的值，而是​**​一个矩阵，代表我们对当前状态估计值可信度（不确定性）的量化​**​。对角线上的元素代表各个状态变量估计的方差（不确定度），非对角元素代表状态变量之间估计误差的协方差（相关性）。卡尔曼滤波在每一步都同时更新状态估计 (`x`) 和其协方差 (`P`)，协方差`P`的演变是算法精妙之处所在。
- **卡尔曼增益 (`K`)**：它是一个​**​权重矩阵​**​，决定了我们更​**​“相信”​**​ 预测值还是测量值。
    - ​**​测量噪声小​**​（`R`小 → 传感器精度高），`K`会更大 → 新测量值在更新中的​**​权重更高​**​。
    - ​**​预测噪声小​**​（预测协方差`P`小 → 模型预测非常准确/不确定性低），`K`会更小 → ​**​更倾向于相信预测值​**​。
    - 事实上`K`是基于预测协方差`P`、观测模型`H`和测量噪声协方差`R`计算出来的。计算方法为$K = P_{predicted} * H^T * (H * P_{predicted} * H^T + R)^-1$

# Previously

卡尔曼滤波，用直白的话来讲，就是你有多个不确定的数据，经过一系列的算法过程，然后能获得一个相对准确的结果。

他是一种递归算法，有几个前提条件：

- 当前时刻状态只和**上一时刻**状态有关。这个讲的高级点就是**马尔可夫性**
- 模型和系统均满足**线性**关系
- 噪声符合**高斯**分布

对于和多时刻状态有关、非线性、非高斯问题，就不能简单地使用卡尔曼滤波。例如使用拓展卡尔曼滤波器进行姿态解算，此时的卡尔曼滤波器是拓展的，适用于非线性的情况。这是后话。

他通过预测和更新两个步骤来实现对系统状态的最优估计：

- **预测**：基于前一时刻的状态估计值和当前的系统模型，预测当前时刻的状态
- **更新**：当获得当前时刻的观测值后，利用这个信息来修正预测值，得到一个更精确的状态估计值

# 原理

根据上文所述，卡尔曼滤波具有三个前提条件，因此我们可以根据这个条件写出以下的两个公式：
$$x_{k}= F x_{k-1} + B u_{k-1} + w_{k} \tag{1}$$
$$z_{k}= H x_{k} + v_{k} \tag{2}$$
其中$x_{k}$表示k时刻的真实值，是待估计值，而$x_{k-1}$表示k-1时刻的真实值。$u_{k-1}$表示k-1时刻的控制输入量，$z_{k}$表示k时刻的观测值，是我们获取到的传感器的值（请注意他可能和$x_{k}$维度不同）。

可以看出，我们其实并不知道k时刻的噪声，其实就算是模型很精确他多少也存在噪声，因此我们并不能很准确的得到一个真实值$x_k$，所以我们的目标就是获得一个最优的估计值$\hat{x_{k}}$来尽可能接近$x_{k}$，让他的误差达到最小。

