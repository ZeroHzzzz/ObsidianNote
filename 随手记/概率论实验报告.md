# 问题背景描述

在教育教学过程中，家长参与学校活动对于学生的成长有重要影响。为了研究家长参与家长会的情况，设定每个学生的家长来参加家长会的人数为一个随机变量，取值为0、1或2，概率分别为0.05、0.8和0.15。学校共有400名学生，假设每个学生的家长出席情况相互独立且服从相同的分布。

# 实验目的

1.     深入理解中心极限定理，掌握其在实际问题中的应用。
2.     学习使用软件进行模拟仿真，计算样本的均值和方差。
3.     对比理论计算和模拟结果，分析差异原因。

# 实验原理与数学模型

## 随机变量建模

-   定义随机变量 $X_i$，表示第 $i$ 个学生的家长人数，取值为0、1或2，概率分别为0.05、0.8、0.15。
-   总家长人数 $X = \sum_{i=1}^{400} X_i$。
-   定义指示变量 $Y_i$，当第 $i$ 个学生有一名家长来时，$Y_i = 1$，否则 $Y_i = 0$。则一名家长来参加会议的学生人数 $Y = \sum_{i=1}^{400} Y_i$。

## 计算期望和方差

-   对于 $X_i$：
    -   期望：$E(X_i) = 0 \times 0.05 + 1 \times 0.8 + 2 \times 0.15 = 1.1$。
    -   二阶矩：$E(X_i^2) = 0^2 \times 0.05 + 1^2 \times 0.8 + 2^2 \times 0.15 = 1.4$。
    -   方差：$Var(X_i) = E(X_i^2) - [E(X_i)]^2 = 1.4 - (1.1)^2 = 0.19$。
-   对于 $Y_i$：
    -   期望：$E(Y_i) = 1 \times 0.8 + 0 \times 0.2 = 0.8$。
    -   方差：$Var(Y_i) = 0.8 \times (1 - 0.8) = 0.16$。

## 中心极限定理应用

总家长人数 $X$ 和一名家长来参加的学生人数 $Y$ 均可以近似服从正态分布：

-   $X \sim N(nE(X_i), nVar(X_i))$。
-   $Y \sim N(nE(Y_i), nVar(Y_i))$。

# 实验所用软件及版本

本实验使用Python进行仿真模拟，且实验所用的解释器版本及库版本如下：

```
Python >= 3.8
matplotlib==3.9.2
numpy==2.1.3
scipy==1.14.1
```

# 主要内容（要点）

-   **理论计算**：利用中心极限定理计算所求概率。
-   **模拟仿真**：使用Python进行模拟，重复试验，估计概率。
-   **结果分析**：比较理论计算和模拟结果，探讨差异

# 实验过程记录

## 理论计算

-   **总家长人数 $X$ 的概率计算：**
    -   期望：$E(X) = nE(X_i) = 400 \times 1.1 = 440$。
    -   方差：$Var(X) = nVar(X_i) = 400 \times 0.19 = 76$。
    -   标准差：$\sigma_X = \sqrt{76} \approx 8.7178$。
    -   计算 $P(X > 450)$：
        -   使用连续性修正，$z = \frac{450.5 - 440}{8.7178} \approx 1.204$。
        -   查标准正态分布表，$P(Z > 1.204) \approx 0.1149$。
-   **一名家长来参加的学生人数 $Y$ 的概率计算：**
    -   期望：$E(Y) = nE(Y_i) = 400 \times 0.8 = 320$。
    -   方差：$Var(Y) = nVar(Y_i) = 400 \times 0.16 = 64$。
    -   标准差：$\sigma_Y = \sqrt{64} = 8$。
    -   计算 $P(Y \geq 340)$：
        -   使用连续性修正，$z = \frac{339.5 - 320}{8} = 2.4375$。
        -   查标准正态分布表，$P(Z > 2.4375) \approx 0.0074$。

## 模拟仿真

```python
import numpy as np
from scipy.stats import norm
import matplotlib.pyplot as plt

n = 400
simulations = 10000

# 理论计算
E_X = n * 1.1
Var_X = n * 0.19
sigma_X = np.sqrt(Var_X)

E_Y = n * 0.8
Var_Y = n * 0.16
sigma_Y = np.sqrt(Var_Y)

# 计算理论概率
z_X = (450.5 - E_X) / sigma_X
p_X_theoretical = 1 - norm.cdf(z_X)

z_Y = (339.5 - E_Y) / sigma_Y
p_Y_theoretical = 1 - norm.cdf(z_Y)

# 模拟计算
X_values = []
Y_values = []

for _ in range(simulations):
    X_i = np.random.choice([0, 1, 2], size=n, p=[0.05, 0.8, 0.15])
    X_total = np.sum(X_i)
    Y_total = np.sum(X_i == 1)
    X_values.append(X_total)
    Y_values.append(Y_total)

X_values = np.array(X_values)
Y_values = np.array(Y_values)

p_X_simulation = np.mean(X_values > 450)
p_Y_simulation = np.mean(Y_values >= 340)

print(f"理论计算 P(X > 450) = {p_X_theoretical:.4f}")
print(f"模拟计算 P(X > 450) = {p_X_simulation:.4f}")

print(f"理论计算 P(Y >= 340) = {p_Y_theoretical:.4f}")
print(f"模拟计算 P(Y >= 340) = {p_Y_simulation:.4f}")

# 绘制直方图
plt.hist(X_values, bins=30, alpha=0.7)
plt.axvline(450, color='red', linestyle='dashed', linewidth=2)
plt.title('总家长人数 X 分布')
plt.xlabel('总家长人数')
plt.ylabel('频数')
plt.show()

plt.hist(Y_values, bins=30, alpha=0.7, color='green')
plt.axvline(340, color='red', linestyle='dashed', linewidth=2)
plt.title('一名家长来参加的学生人数 Y 分布')
plt.xlabel('学生人数')
plt.ylabel('频数')
plt.show()
```

## 异常情况记录

-   如果设置固定的随机数种子，每次运行结果都相同，因此会导致实验误差。通过不设置随机数种子，或者每次运行时设置不同的种子，可以确保每次模拟结果都不同。
-   在计算标准差时，确保方差非负，否则会产生数学错误。

# 实验结果报告与实验总结

-   **理论计算结果：**
    -   $P(X > 450) \approx 0.1149$。
    -   $P(Y \geq 340) \approx 0.0074$。
-   **模拟计算结果：**
    -   $P(X > 450) \approx 0.1162$（模拟结果可能因运行次数和随机性略有差异）。
    -   $P(Y \geq 340) \approx 0.0071$。
-   **实验总结：**
    -   理论计算结果与模拟结果非常接近，验证了中心极限定理在大样本下的有效性。
    -   模拟结果的微小差异可能由于随机误差和模拟次数有限导致。
    -   通过实验，加深了对概率分布和统计理论的理解，掌握了使用Python进行模拟仿真的基本方法。

# 思考与深入

-   **模拟次数的影响：**
    -   增加模拟次数可以提高结果的精确度，减小随机误差。
-   **中心极限定理的条件：**
    -   本实验中，样本量较大（$n=400$），满足中心极限定理的应用条件。
    -   若样本量较小，需考虑使用其他分布（如二项分布或泊松分布）进行计算。
-   **进一步研究：**
    -   可以探索不同概率分布下的家长出席情况，观察结果的变化。
    -   研究分布的偏度和峰度，了解数据分布特性。
-   **实际应用：**
    -   本实验的方法可应用于其他领域，如市场调查、质量控制等需要对大样本进行概率分析的问题。
