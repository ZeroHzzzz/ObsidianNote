## NAV2架构

### BT Navigator Server（导航行为树服务器）

-   **功能**：BT Navigator Server是Nav2中的行为树（Behavior Tree）管理器。行为树是一种组织和调度不同导航任务的方法。BT Navigator Server负责调用和管理下面的三个小服务（Planner Server、Controller Server、Recovery Server），以实现机器人导航任务的高层逻辑控制。
-   **行为树的作用**：它允许在任务中使用逻辑控制，例如顺序、选择、并行执行等，这使得导航任务可以变得更加灵活和可扩展。比如，可以定义在某个条件下切换到特定的恢复行为。

### Planner Server（规划服务器）

-   **功能**：Planner Server负责全局路径规划，即计算从机器人当前位置到目标位置的最佳路径。这通常涉及到在一个已知的地图上计算出避免障碍物的路径。使用的算法通常包括A\*、Dijkstra等。
-   **配置**：开发者可以选择不同的全局路径规划器插件（例如NavFn、SmacPlanner等）来适应不同的导航需求。配置这些插件的参数可以影响路径的规划质量和效率。

### Controller Server（控制服务）

-   **功能**：控制服务器（或局部规划器）负责根据全局规划的路径，实时控制机器人沿着这条路径行进。它需要处理实际的传感器输入和可能的动态障碍物，做出调整以保持在路径上。常用的方法包括DWA（动态窗口法）、TEB（时间弹性带）等。
-   **配置**：类似于规划服务器，控制服务器也可以使用不同的控制器插件。每个插件有不同的特点，例如对速度、路径跟随精度、避障能力的要求等。

### Recovery Server（恢复服务器）

-   **功能**：Recovery Server在机器人遇到异常情况（如遇到无法避开的障碍物、导航失败等）时被调用。恢复器的目标是采取措施使机器人回到正常的导航状态。例如，如果机器人卡在某个地方，可以尝试后退、旋转或选择新的路径。
-   **配置**：Nav2提供了几种默认的恢复行为（如旋转恢复、清除路径等），但开发者也可以定义自己的恢复行为以满足特定需求。

## NAV2工具

nav2提供了以下工具：

### 1. **地图服务器 (Map Server)**

-   **功能**：地图服务器负责加载、提供和存储环境的地图。地图通常是以网格格式存储的，占据空间的区域被标记为障碍物。导航系统利用这些地图进行路径规划和定位。
-   **用途**：当机器人启动时，地图服务器会加载预定义的地图（通常是2D平面图），并将其提供给其他组件，如路径规划器和AMCL，以便这些组件可以知道环境的布局和障碍物位置。

### 2. **自适应蒙特卡洛定位 (AMCL, Adaptive Monte Carlo Localization)**

-   **功能**：AMCL是一个定位算法，用于估计机器人在已知地图中的位置。它通过粒子滤波器结合传感器数据（如激光雷达）来进行定位。
-   **用途**：AMCL帮助机器人确定其在地图中的精确位置，这对于路径规划和避障非常重要。AMCL通过不断地更新位置估计，使机器人能够在动态环境中自我定位。

### 3. **路径规划工具 (Nav2 Planner)**

-   **功能**：Nav2 Planner负责计算从起点到目标点的最优路径。这涉及使用全局路径规划算法，如A\*或Dijkstra算法，找到避开障碍物的最短路径。
-   **用途**：在给定地图和机器人位置的情况下，规划器生成一条路径，这条路径是导航系统用来引导机器人的蓝图。全局规划器生成的路径是基于地图上所有已知的障碍物。

### 4. **路径控制工具 (Nav2 Controller)**

-   **功能**：Nav2 Controller负责沿着规划的路径控制机器人的运动。它接收路径规划器生成的路径，并确保机器人准确且平滑地沿着该路径移动，同时动态避开移动的障碍物。
-   **用途**：Controller是实现路径跟随的核心组件。它使用局部路径规划算法，如DWA（动态窗口法）来实时调整机器人的运动，确保机器人保持在路径上，并根据传感器反馈避开突然出现的障碍物。

### 5. **成本地图 (Nav2 Costmap 2D)**

-   **功能**：成本地图是将传感器数据转换为地图上各个区域的成本值。成本越高的区域代表障碍物或不安全的区域。成本地图2D模块生成和更新这些地图，使机器人能够理解环境中的危险区域。
-   **用途**：在路径规划和路径跟随过程中，成本地图帮助规划器和控制器确定哪些区域是安全的，哪些区域应该避开。这是实现实时避障和路径调整的基础。

### 6. **行为树和BT Navigator (Nav2 Behavior Trees and BT Navigator)**

-   **功能**：行为树是一种用于实现复杂机器人行为的工具。BT Navigator使用行为树来调度和管理导航任务，如路径规划、控制、恢复等。
-   **用途**：行为树的模块化和可视化特点使得它们非常适合处理复杂的任务序列和逻辑。通过行为树，开发者可以定义在不同情况下应该采取的行动，如在导航失败时启动恢复行为。

### 7. **恢复工具 (Nav2 Recoveries)**

-   **功能**：恢复工具用于在导航失败或遇到不可预测的情况时执行恢复行为。这些行为可能包括原地旋转、重新计算路径或清除障碍物。
-   **用途**：恢复机制是容错系统的一部分，确保机器人在遇到问题时能够恢复到可导航状态。它们帮助机器人应对如路径阻塞、定位失败等情况。

### 8. **导航点跟随工具 (Nav2 Waypoint Follower)**

-   **功能**：Waypoint Follower使机器人能够按照预先定义的导航点序列进行导航。这些导航点是一些特定的路径点，机器人会依次到达每一个。
-   **用途**：这种方式对于需要沿特定路线或执行巡逻任务的应用非常有用。导航点跟随工具可以帮助机器人在多个目标点之间移动。

### 9. **生命周期管理工具和看门狗 (Nav2 Lifecycle Manager)**

-   **功能**：生命周期管理工具用于管理各个Nav2节点的状态。它可以启动、暂停和停止各个组件，确保系统以一致的状态运行。
-   **用途**：生命周期管理通过管理节点的生命周期来优化资源使用，确保系统在需要时能够可靠地启动和关闭。看门狗功能监控各个组件的运行状态，并在检测到故障时进行响应。

### 10. **Nav2 核心插件 (Nav2 Core)**

-   **功能**：Nav2 Core定义了插件的接口，使开发者能够创建自己的路径规划器、控制器或恢复行为插件。
-   **用途**：通过插件化接口，Nav2系统可以根据具体应用需求进行扩展。开发者可以实现自定义的导航算法或行为，插入到现有的Nav2框架中.

因此我们可以知道：需要启动nav2需要以下几个部分

-   map：地图，用来了解环境
-   Sensor Data：传感器数据传入到规划服务器(Planner Server)，用来找路
-   状态估计(TF变换)：告知不同坐标系的变换规则，建立map到机器人的关系,并确定机器人位于什么位置(nav2默认使用了AMCL(自适应蒙特卡洛定位)算法)
-   BT：机器人的行为决策

因此，我们如果要使用nav2，其实就是启动一个个nav2中的这些小组件，然后让nav2能够依据这些信息来导航。
