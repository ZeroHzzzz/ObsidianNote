我们继续用刚才[[正运动学]]中的二维双杆机械臂的例子，来推 **逆运动学 (Inverse Kinematics, IK)**。

已知末端坐标$(x,y)$和杆子长度$L_1,L_2$，求关节角度$\theta_{1},\theta_{2}$

首先我们要看能不能够得到：

$$
|L_1 - L_2| \leq \sqrt{x^2 + y^2} \leq L_1 + L_2
$$

如果太远（$\sqrt{x^2 + y^2} > L_1 + L_2$）或者太近（$< |L_1 - L_2|$），那手臂根本够不到。

然后根据余弦定理（在三角形中）：

$$
\cos \theta_2 = \frac{x^2 + y^2 - L_1^2 - L_2^2}{2L_1L_2}
$$

所以：

$$
\theta_2 = \arccos \left( \frac{x^2 + y^2 - L_1^2 - L_2^2}{2L_1L_2} \right)
$$

注意：$\arccos$ 有两个解（对称的），一个对应“手肘朝上”，一个对应“手肘朝下”。
然后再求 $\theta_1$，先算末端相对原点的角度：

$$
\alpha = \arctan 2(y, x)
$$

再算由几何关系得到的补角：

$$
\beta = \arctan 2(L_2 \sin \theta_2, L_1 + L_2 \cos \theta_2)
$$

最后：

$$
\theta_1 = \alpha - \beta
$$
